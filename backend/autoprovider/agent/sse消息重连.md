# sse消息重连功能

## 功能概述

该功能的作用就是和前端进行重连，前端可能因为刷新页面或者退出会话等操作断开了和后端的sse连接，但是我们的操作还是要继续的，所以我们需要开发一个消息通道重新连接的功能

## 功能设计

### 输入

因为我们在使用sse通信的时候，clientId使用的是sessionId。也就是用户此时会话的id，所以用户应该要传sessionId过来，然后我们后端重新和他建立连接。并且续上当时的对话。。

### 一些设计:

1. 前端传过来sessionId，此时不一定还在进行对话，可能后端的任务已经完成了。所以可以设计成，前端只要重新进入了这个session的会话，就会进行一次重连尝试，后端可能会返回告诉他没有匹配到正在进行的通信，但是res.send的status是0，因为是请求成功了。data中可以写：last work is done。
2. 前端在进入会话窗口的时候会调用getSessionOperation恢复已经完成的操作，并且成功再次建立连接之后，默认最新的通信消息都接上最后一条消息后面。

### 任务

首先完成后端的一个方法和一个接口，接受重连请求和设置重连请求。

然后修改前端代码，进入会话窗口之后就要调用一次重连请求。

# 终止会话操作

给前端添加一个终止会话的操作按钮。和：“回撤此操作”一样，按钮的出现通过判断当前是否正在进行sse连接，如果正在进行sse连接，则把发送按钮的icon换成终止会话的icon。如果没有在进行sse连接则出现发送按钮。

用户在点击终止按钮的时候应该先弹出一个comfire消息组件，让用户确认之后再终止会话

在后端中，需要新建一个全局的任务队列，是直接运行在服务器之中的，任务队列的作用就是：

用户发起了一个会话请求，即调用了一个AgentWork，那么我们应该构建一个队列item，item就是一个sessionId和对应的AgentWork任务。

然后给后端添加一个终止会话接口，在接受到用户传递过来的sessionId之后，处理过程就是首先终止任务队列中sessionId对应的AgentWork的进程